(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,64311,(e,t,a)=>{t.exports=e.r(28735)},48253,e=>{"use strict";var t=e.i(89589),a=e.i(59694),r=e.i(64311);function s(){let e=(0,r.useSearchParams)(),s=(0,r.useRouter)(),[l,i]=(0,a.useState)([]),[n,o]=(0,a.useState)(new Set),[c,d]=(0,a.useState)(!1),[m,g]=(0,a.useState)(!0),[p,u]=(0,a.useState)(null);(0,a.useEffect)(()=>{let t=e.get("campaignId");if(!t){alert("No campaign ID found"),s.push("/generate");return}let a=`campaign_${t}`,r=localStorage.getItem(a);if(!r){alert("Campaign data not found"),s.push("/generate");return}let l=JSON.parse(r);u(l);let n=`campaign_${t}_images`,c=localStorage.getItem(n);if(c){let e=JSON.parse(c);i(e),o(new Set(e.map(e=>e.id))),g(!1)}else x(l,t)},[e,s]);let x=async(e,t)=>{g(!0);try{let a=await fetch("https://us-central1-vid-ad.cloudfunctions.net/generateScenes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formData:e,numberOfScenes:5})}),r=await a.json();if(!r.success)throw Error(r.error||"Failed to generate images");i(r.images);let s=new Set(r.images.map(e=>e.id));o(s);let l=`campaign_${t}_images`;localStorage.setItem(l,JSON.stringify(r.images)),g(!1)}catch(e){console.error("Error:",e),alert(`Failed to generate images: ${e instanceof Error?e.message:"Unknown error"}`),s.push("/generate")}},h=(t,a)=>{let r=[...l],[s]=r.splice(t,1);if(!s)return;r.splice(a,0,s);let n=r.map((e,t)=>({...e,sceneNumber:t+1}));i(n);let o=e.get("campaignId");if(o){let e=`campaign_${o}_images`;localStorage.setItem(e,JSON.stringify(n))}},b=async t=>{d(!0);try{let a=l.find(e=>e.sceneNumber===t);if(!a)return void d(!1);let r=await fetch("https://us-central1-vid-ad.cloudfunctions.net/regenerateScene",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({originalPrompt:a.prompt,sceneNumber:t})}),s=await r.json();if(!s.success)throw Error(s.error);i(e=>e.map(e=>e.sceneNumber===t?s.image:e));let n=e.get("campaignId");if(n){let e=`campaign_${n}_images`,a=l.map(e=>e.sceneNumber===t?s.image:e);localStorage.setItem(e,JSON.stringify(a))}}catch(e){console.error("Error:",e),alert("Failed to regenerate image")}finally{d(!1)}},f=async()=>{d(!0);try{let t=l.filter(e=>n.has(e.id));if(0===t.length){alert("Please select at least one scene to save"),d(!1);return}if(!e.get("campaignId")){alert("Campaign ID not found"),d(!1);return}let a=new FormData,r={name:p?.productName||"Untitled Campaign",description:p?.keyMessage||"",scenes:t.map(e=>({sceneNumber:e.sceneNumber,prompt:e.prompt,duration:Math.floor((p?.duration||7)/t.length),visualDescription:e.description||"",voiceoverText:e.description||""})),totalScenes:t.length,status:"draft"};for(let e of(a.append("campaignData",JSON.stringify(r)),t))try{let t=await fetch(e.url),r=await t.blob(),s=new File([r],`scene-${e.sceneNumber}.jpg`,{type:"image/jpeg"});a.append(`sceneImage_${e.sceneNumber}`,s)}catch(t){console.error(`Failed to fetch image for scene ${e.sceneNumber}:`,t)}let s=await fetch("/api/campaigns/save",{method:"POST",body:a});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to save campaign")}let i=await s.json();alert(`Campaign saved successfully! ID: ${i.campaign.id}`)}catch(e){console.error("Save campaign error:",e),alert(`Failed to save campaign: ${e instanceof Error?e.message:"Unknown error"}`)}finally{d(!1)}};return m?(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center p-6",children:(0,t.jsxs)("div",{className:"max-w-2xl w-full bg-white rounded-2xl shadow-xl p-12 text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-20 w-20 border-b-4 border-purple-600 mx-auto mb-6"}),(0,t.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-3",children:"Generating Your Scenes..."}),(0,t.jsx)("p",{className:"text-gray-600 mb-2",children:"Creating 5 unique images optimized for your product"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"This will take about 10-15 seconds"}),p&&(0,t.jsxs)("div",{className:"mt-6 text-left bg-gray-50 rounded-lg p-4",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Product:"})," ",p.productName]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mt-1",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Brand Tone:"})," ",p.brandTone]}),(0,t.jsxs)("p",{className:"text-sm text-gray-700 mt-1",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Orientation:"})," ",p.orientation]})]})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-6",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"Review Your Scenes"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Select, reorder, or regenerate scenes before creating your video"}),p&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Product: ",p.productName," â€¢ ",p.brandTone," tone â€¢"," ",p.orientation]})]}),(0,t.jsx)("button",{onClick:()=>s.push("/generate?new=true"),className:"px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"â† Start Over"})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mb-8",children:l.map((e,a)=>(0,t.jsxs)("div",{className:`relative group rounded-xl overflow-hidden border-4 transition-all ${n.has(e.id)?"border-green-500 shadow-lg":"border-gray-200 opacity-60"}`,children:[(0,t.jsxs)("div",{className:"aspect-[9/16] relative bg-gray-100",children:[e.url?(0,t.jsx)("img",{src:e.url,alt:`Scene ${e.sceneNumber}`,className:"w-full h-full object-cover",onError:t=>{console.error("Image load error:",e.url),t.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="711"><rect width="400" height="711" fill="%23f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%239ca3af" font-family="sans-serif" font-size="16">Failed to load</text></svg>',t.currentTarget.className="w-full h-full object-contain p-8"},onLoad:()=>console.log(`âœ… Image ${e.sceneNumber} loaded successfully`),loading:"lazy"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-gray-400",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-sm",children:"Loading..."})]})}),(0,t.jsxs)("div",{className:"absolute top-3 left-3 bg-purple-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:["Scene ",e.sceneNumber]}),n.has(e.id)&&(0,t.jsx)("div",{className:"absolute top-3 right-3 bg-green-500 text-white p-2 rounded-full",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),(0,t.jsxs)("div",{className:"p-4 bg-white space-y-2",children:[e.description&&(0,t.jsx)("p",{className:"text-xs text-gray-600 line-clamp-2 mb-2",children:e.description}),e.mood&&(0,t.jsxs)("p",{className:"text-xs text-purple-600 font-medium",children:["Mood: ",e.mood]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>b(e.sceneNumber),disabled:c,className:"flex-1 px-3 py-2 border border-purple-600 text-purple-600 rounded-lg hover:bg-purple-50 transition-colors text-sm font-medium disabled:opacity-50",children:"ðŸ”„ Regenerate"}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void o(e=>{let a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a})},className:`flex-1 px-3 py-2 rounded-lg transition-colors text-sm font-medium ${n.has(e.id)?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:n.has(e.id)?"âœ“ Selected":"Select"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>h(a,Math.max(0,a-1)),disabled:0===a,className:"flex-1 px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-30 text-xs",children:"â† Move Up"}),(0,t.jsx)("button",{onClick:()=>h(a,Math.min(l.length-1,a+1)),disabled:a===l.length-1,className:"flex-1 px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-30 text-xs",children:"Move Down â†’"})]})]})]},e.id))}),(0,t.jsx)("div",{className:"border-t pt-6",children:(0,t.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,t.jsxs)("p",{className:"text-center text-foreground mb-4",children:[n.size," scene",1!==n.size?"s":""," selected"]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("button",{onClick:f,disabled:c||0===n.size,className:"w-full bg-card border-2 border-primary text-primary py-4 rounded-lg font-semibold text-lg hover:bg-primary hover:text-primary-foreground transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"ðŸ’¾ Saving Campaign...":"ðŸ’¾ Save Campaign to Library"}),(0,t.jsx)("button",{onClick:()=>{let t=l.filter(e=>n.has(e.id));if(t.length<2)return void alert("Please select at least 2 images to create a video");let a=e.get("campaignId");if(a){let e=`campaign_${a}_selected_images`;localStorage.setItem(e,JSON.stringify(t)),s.push(`/generate/results/?campaignId=${a}`)}},disabled:n.size<2,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 rounded-lg font-semibold text-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:"Create Video from Selected Scenes â†’"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center mt-3",children:"Save your campaign to access it later, or proceed to create a video"})]})})]})})})}function l(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-20 w-20 border-b-4 border-purple-600"})}),children:(0,t.jsx)(s,{})})}e.s(["default",()=>l])}]);