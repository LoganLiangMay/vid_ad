(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92923,38675,e=>{"use strict";var t=e.i(56808),r=e.i(31272),a=e.i(26151);function n(e,t){let r={};for(let a in e)e.hasOwnProperty(a)&&(r[a]=t(e[a]));return r}function o(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e)||!0===e||!1===e||"[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>o(e));if("function"==typeof e||"object"==typeof e)return n(e,e=>o(e));throw Error("Data cannot be encoded in JSON: "+e)}function i(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{let t=Number(e.value);if(isNaN(t))throw Error("Data cannot be decoded from JSON: "+e);return t}default:throw Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>i(e)):"function"==typeof e||"object"==typeof e?n(e,e=>i(e)):e}let s="functions",l={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class c extends r.FirebaseError{constructor(e,t,r){super(`${s}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,c.prototype)}}function u(e,t){let r,a=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),n=a;try{let e=t&&t.error;if(e){let t=e.status;if("string"==typeof t){if(!l[t])return new c("internal","internal");a=l[t],n=t}let o=e.message;"string"==typeof o&&(n=o),r=e.details,void 0!==r&&(r=i(r))}}catch(e){}return"ok"===a?null:new c(a,n,r)}class d{constructor(e,r,a,n){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,(0,t._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=a.getImmediate({optional:!0}),this.auth||r.get().then(e=>this.auth=e,()=>{}),this.messaging||a.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n?.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{let e=await this.auth.getToken();return e?.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){let t=await this.getAuthToken();return{authToken:t,messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}let h="us-central1",g=/^data: (.*?)(?:\n|$)/;class p{constructor(e,t,r,a,n=h,o=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new d(e,t,r,a),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(n);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=h}catch(e){this.customDomain=null,this.region=n}}_delete(){return this.deleteService()}_url(e){let t=this.app.options.projectId;if(null!==this.emulatorOrigin){let r=this.emulatorOrigin;return`${r}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function m(e){return e.emulatorOrigin&&(0,r.isCloudWorkstation)(e.emulatorOrigin)?"include":void 0}async function f(e,t,r,a,n){let o;r["Content-Type"]="application/json";try{o=await a(e,{method:"POST",body:JSON.stringify(t),headers:r,credentials:m(n)})}catch(e){return{status:0,json:null}}let i=null;try{i=await o.json()}catch(e){}return{status:o.status,json:i}}async function w(e,t){let r={},a=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return a.authToken&&(r.Authorization="Bearer "+a.authToken),a.messagingToken&&(r["Firebase-Instance-ID-Token"]=a.messagingToken),null!==a.appCheckToken&&(r["X-Firebase-AppCheck"]=a.appCheckToken),r}async function A(e,t,r,a){var n;let s,l={data:r=o(r)},d=await w(e,a),h=(n=a.timeout||7e4,s=null,{promise:new Promise((e,t)=>{s=setTimeout(()=>{t(new c("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{s&&clearTimeout(s)}}),g=await Promise.race([f(t,l,d,e.fetchImpl,e),h.promise,e.cancelAllRequests]);if(h.cancel(),!g)throw new c("cancelled","Firebase Functions instance was deleted.");let p=u(g.status,g.json);if(p)throw p;if(!g.json)throw new c("internal","Response is not valid JSON object.");let m=g.json.data;if(void 0===m&&(m=g.json.result),void 0===m)throw new c("internal","Response is missing data field.");return{data:i(m)}}async function y(e,t,r,a){var n,s,l,d;let h,p,f,A,y,C={data:r=o(r)},k=await w(e,a);k["Content-Type"]="application/json",k.Accept="text/event-stream";try{f=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(C),headers:k,signal:a?.signal,credentials:m(e)})}catch(t){if(t instanceof Error&&"AbortError"===t.name){let e=new c("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}let e=u(0,null);return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}let v=new Promise((e,t)=>{A=e,y=t});a?.signal?.addEventListener("abort",()=>{let e=new c("cancelled","Request was cancelled.");y(e)});let T=(n=f.body.getReader(),s=A,l=y,d=a?.signal,h=(e,t)=>{let r=e.match(g);if(!r)return;let a=r[1];try{let e=JSON.parse(a);if("result"in e)return void s(i(e.result));if("message"in e)return void t.enqueue(i(e.message));if("error"in e){let r=u(0,e);t.error(r),l(r);return}}catch(e){if(e instanceof c){t.error(e),l(e);return}}},p=new TextDecoder,new ReadableStream({start(e){let t="";return r();async function r(){if(d?.aborted){let t=new c("cancelled","Request was cancelled");return e.error(t),l(t),Promise.resolve()}try{let{value:a,done:o}=await n.read();if(o){t.trim()&&h(t.trim(),e),e.close();return}if(d?.aborted){let t=new c("cancelled","Request was cancelled");e.error(t),l(t),await n.cancel();return}let i=(t+=p.decode(a,{stream:!0})).split("\n");for(let r of(t=i.pop()||"",i))r.trim()&&h(r.trim(),e);return r()}catch(r){let t=r instanceof c?r:u(0,null);e.error(t),l(t)}}},cancel:()=>n.cancel()}));return{stream:{[Symbol.asyncIterator](){let e=T.getReader();return{async next(){let{value:t,done:r}=await e.read();return{value:t,done:r}},return:async()=>(await e.cancel(),{done:!0,value:void 0})}}},data:v}}let C="@firebase/functions",k="0.13.1";function v(e=(0,t.getApp)(),a=h){let n=(0,t._getProvider)((0,r.getModularInstance)(e),s).getImmediate({identifier:a}),o=(0,r.getDefaultEmulatorHostnameAndPort)("functions");return o&&T(n,...o),n}function T(e,t,a){var n;let o;n=(0,r.getModularInstance)(e),o=(0,r.isCloudWorkstation)(t),n.emulatorOrigin=`http${o?"s":""}://${t}:${a}`,o&&((0,r.pingServer)(n.emulatorOrigin+"/backends"),(0,r.updateEmulatorBanner)("Functions",!0))}function S(e,t,a){var n;let o;return n=(0,r.getModularInstance)(e),(o=e=>{var r,o,i,s;let l;return r=n,o=t,i=e,s=a||{},l=r._url(o),A(r,l,i,s)}).stream=(e,r)=>{var a,o,i,s;let l;return a=n,o=t,i=e,s=r,l=a._url(o),y(a,l,i,s||{})},o}function I(e,t,a){var n;let o;return n=(0,r.getModularInstance)(e),(o=e=>A(n,t,e,a||{})).stream=(e,r)=>y(n,t,e,r||{}),o}(0,t._registerComponent)(new a.Component(s,(e,{instanceIdentifier:t})=>new p(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("messaging-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,t.registerVersion)(C,k,void 0),(0,t.registerVersion)(C,k,"esm2020"),e.s(["FunctionsError",()=>c,"connectFunctionsEmulator",()=>T,"getFunctions",()=>v,"httpsCallable",()=>S,"httpsCallableFromURL",()=>I],38675),e.s([],92923)},88236,e=>{"use strict";var t=e.i(89589),r=e.i(59694);e.i(64752);var a=e.i(66870),n=e.i(39555);e.i(59539);var o=e.i(22008);let i=(0,r.createContext)(void 0);function s(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function l({children:e}){let[s,l]=(0,r.useState)(null),[c,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(!0),[g,p]=(0,r.useState)(null),m=async(e,t)=>{if(!e)return;let r=(0,o.doc)(n.firestore,"users",e.uid),a=await (0,o.getDoc)(r);if(a.exists()){await (0,o.updateDoc)(r,{lastLogin:(0,o.serverTimestamp)()});let t=a.data();u({uid:e.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,createdAt:t.createdAt?.toDate(),lastLogin:t.lastLogin?.toDate(),metadata:t.metadata})}else{let a={uid:e.uid,email:e.email,displayName:e.displayName||t?.displayName||null,photoURL:e.photoURL,createdAt:new Date,lastLogin:new Date,...t};try{await (0,o.setDoc)(r,{...a,createdAt:(0,o.serverTimestamp)(),lastLogin:(0,o.serverTimestamp)()}),u(a)}catch(e){console.error("Error creating user profile:",e),p("Failed to create user profile")}}},f=async(e,t,r)=>{p(null);try{let o=await (0,a.createUserWithEmailAndPassword)(n.auth,e,t);return r&&o.user&&await (0,a.updateProfile)(o.user,{displayName:r}),await m(o.user,{displayName:r}),await w(o.user),o}catch(e){throw p(e.message),e}},w=async e=>{try{console.log("ðŸª [AuthContext] Creating session cookie for user:",e.email);let t=await e.getIdToken();console.log("ðŸ”‘ [AuthContext] Got ID token, calling /api/auth/session");let r=await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:t})});if(r.ok)console.log("âœ… [AuthContext] Session cookie created successfully");else{console.error("âŒ [AuthContext] Failed to create session cookie:",r.status);let e=await r.text();console.error("Error details:",e)}}catch(e){console.error("âŒ [AuthContext] Error creating session cookie:",e)}},A=async(e,t,r=!1)=>{p(null);try{await (0,a.setPersistence)(n.auth,r?a.browserLocalPersistence:a.browserSessionPersistence);let o=await (0,a.signInWithEmailAndPassword)(n.auth,e,t);return o.user&&(await m(o.user),await w(o.user),r&&localStorage.setItem("sessionStartTime",new Date().toISOString())),o}catch(e){throw p(e.message),e}},y=async()=>{p(null);try{console.log("ðŸ”‘ [AuthContext] loginWithGoogle called"),console.log("ðŸ” [AuthContext] Current auth config:",{apiKey:n.auth.app.options.apiKey?.substring(0,10)+"...",authDomain:n.auth.app.options.authDomain,projectId:n.auth.app.options.projectId});{let e=new URLSearchParams(window.location.search).get("returnUrl")||"/dashboard";localStorage.setItem("authRedirectUrl",e),console.log("ðŸ’¾ [AuthContext] Stored returnUrl:",e)}console.log("ðŸ”§ [AuthContext] Creating GoogleAuthProvider...");let e=new a.GoogleAuthProvider;e.addScope("profile"),e.addScope("email"),console.log("ðŸš€ [AuthContext] Calling signInWithRedirect..."),console.log("ðŸŒ [AuthContext] Expected redirect to:",`https://${n.auth.app.options.authDomain}/__/auth/handler`),await (0,a.signInWithRedirect)(n.auth,e),console.log("âœ… [AuthContext] signInWithRedirect completed (should redirect now)")}catch(e){throw console.error("âŒ [AuthContext] loginWithGoogle error:",{message:e.message,code:e.code,stack:e.stack}),p(e.message),e}},C=async()=>{p(null);try{{let e=new URLSearchParams(window.location.search).get("returnUrl")||"/dashboard";localStorage.setItem("authRedirectUrl",e)}let e=new a.OAuthProvider("apple.com");await (0,a.signInWithRedirect)(n.auth,e)}catch(e){throw p(e.message),e}},k=async()=>{p(null);try{await fetch("/api/auth/logout",{method:"POST"}),await (0,a.signOut)(n.auth),u(null),localStorage.removeItem("sessionStartTime"),localStorage.removeItem("oauthSuccess"),localStorage.removeItem("authRedirectUrl")}catch(e){throw p(e.message),e}},v=()=>{let e=localStorage.getItem("sessionStartTime");if(e&&s){let t=new Date(e);(new Date().getTime()-t.getTime())/864e5>30&&(k(),p("Your session has expired after 30 days. Please log in again."))}},T=async e=>{p(null);try{await (0,a.sendPasswordResetEmail)(n.auth,e)}catch(e){throw p(e.message),e}},S=async e=>{if(!s)return void p("No user logged in");p(null);try{let t=(0,o.doc)(n.firestore,"users",s.uid);await (0,o.updateDoc)(t,e),u(t=>t?{...t,...e}:null),(void 0!==e.displayName||void 0!==e.photoURL)&&await (0,a.updateProfile)(s,{displayName:e.displayName||s.displayName,photoURL:e.photoURL||s.photoURL})}catch(e){throw p(e.message),e}};return(0,r.useEffect)(()=>{let e=!0,t=setTimeout(()=>{e&&d&&(console.warn("Auth initialization timed out, setting loading to false"),h(!1))},5e3);(async()=>{try{console.log("ðŸ”„ [AuthContext] Checking for OAuth redirect result...");let e=await (0,a.getRedirectResult)(n.auth);e&&e.user?(console.log("âœ… [AuthContext] OAuth redirect successful, user:",e.user.email),console.log("ðŸª [AuthContext] About to create session cookie..."),await w(e.user),console.log("âœ… [AuthContext] Session cookie creation completed"),m(e.user).catch(e=>{console.error("âŒ [AuthContext] Error creating user profile:",e)}),localStorage.setItem("sessionStartTime",new Date().toISOString()),localStorage.setItem("oauthSuccess","true"),console.log("âœ… [AuthContext] OAuth flow completed, marked as success")):console.log("â„¹ï¸ [AuthContext] No OAuth redirect result found")}catch(e){console.error("âŒ [AuthContext] OAuth redirect error:",e),p(e.message||"Failed to sign in with OAuth provider")}})();let r=(0,a.onAuthStateChanged)(n.auth,async r=>{if(e){if(console.log("ðŸ‘¤ [AuthContext] onAuthStateChanged fired:",{hasUser:!!r,email:r?.email,uid:r?.uid}),l(r),r){console.log("âœ… [AuthContext] User is authenticated, creating session cookie..."),await w(r);let e=(0,o.doc)(n.firestore,"users",r.uid);try{let t=await (0,o.getDoc)(e);if(t.exists()){let e=t.data();u({uid:r.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,createdAt:e.createdAt?.toDate(),lastLogin:e.lastLogin?.toDate(),metadata:e.metadata})}else m(r).catch(e=>{console.error("Error creating user profile in auth listener:",e)});v()}catch(e){console.error("Error fetching user profile:",e)}}else console.log("âŒ [AuthContext] No user authenticated"),u(null);h(!1),clearTimeout(t)}}),i=setInterval(()=>{v()},36e5);return()=>{e=!1,clearTimeout(t),r(),clearInterval(i)}},[]),(0,t.jsx)(i.Provider,{value:{currentUser:s,userProfile:c,loading:d,error:g,signup:f,login:A,loginWithGoogle:y,loginWithApple:C,logout:k,resetPassword:T,updateUserProfile:S,clearError:()=>p(null),checkSessionExpiry:v},children:e})}e.s(["AuthProvider",()=>l,"useAuth",()=>s])}]);